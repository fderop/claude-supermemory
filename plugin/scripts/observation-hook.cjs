#!/usr/bin/env node
var u=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var S=u((M,l)=>{var n=require("node:fs"),a=require("node:path"),m=require("node:os"),i=a.join(m.homedir(),".claude-memory"),r=a.join(i,"settings.json"),p={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function O(){n.existsSync(i)||n.mkdirSync(i,{recursive:!0})}function E(){let e={...p};try{if(n.existsSync(r)){let t=n.readFileSync(r,"utf-8");Object.assign(e,JSON.parse(t))}}catch(t){console.error(`Settings: Failed to load ${r}: ${t.message}`)}return process.env.CLAUDE_MEMORY_SKIP_TOOLS&&(e.skipTools=process.env.CLAUDE_MEMORY_SKIP_TOOLS.split(",").map(t=>t.trim())),process.env.CLAUDE_MEMORY_DEBUG==="true"&&(e.debug=!0),e}function y(e){O(),n.writeFileSync(r,JSON.stringify(e,null,2))}function _(e,t){return t.skipTools.includes(e)?!1:t.captureTools&&t.captureTools.length>0?t.captureTools.includes(e):!0}function h(e,t,s){if(e.debug){let o=new Date().toISOString();console.error(s?`[${o}] ${t}: ${JSON.stringify(s)}`:`[${o}] ${t}`)}}l.exports={SETTINGS_DIR:i,SETTINGS_FILE:r,DEFAULT_SETTINGS:p,loadSettings:E,saveSettings:y,shouldCaptureTool:_,debugLog:h}});var f=u((U,d)=>{async function I(){return new Promise((e,t)=>{let s="";process.stdin.setEncoding("utf8"),process.stdin.on("data",o=>{s+=o}),process.stdin.on("end",()=>{try{e(s.trim()?JSON.parse(s):{})}catch(o){t(new Error(`Failed to parse stdin JSON: ${o.message}`))}}),process.stdin.on("error",t),process.stdin.isTTY&&e({})})}function c(e){console.log(JSON.stringify(e))}function N(e=null){c(e?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:e}}:{continue:!0,suppressOutput:!0})}function $(e){console.error(`Memory: ${e}`),c({continue:!0,suppressOutput:!0})}d.exports={readStdin:I,writeOutput:c,outputSuccess:N,outputError:$}});var{loadSettings:L,debugLog:g}=S(),{readStdin:k,outputSuccess:T}=f();async function D(){let e=L();try{let t=await k(),s=t.session_id,o=t.tool_name;g(e,"PostToolUse",{sessionId:s,toolName:o}),T()}catch(t){g(e,"Error",{error:t.message}),T()}}D().catch(e=>{console.error(`Supermemory fatal: ${e.message}`),process.exit(1)});
