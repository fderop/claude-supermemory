#!/usr/bin/env node
var c=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var S=c((M,l)=>{var n=require("node:fs"),a=require("node:path"),T=require("node:os"),i=a.join(T.homedir(),".claude-memory"),o=a.join(i,"settings.json"),p={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function O(){n.existsSync(i)||n.mkdirSync(i,{recursive:!0})}function E(){let e={...p};try{if(n.existsSync(o)){let t=n.readFileSync(o,"utf-8");Object.assign(e,JSON.parse(t))}}catch(t){console.error(`Settings: Failed to load ${o}: ${t.message}`)}return process.env.CLAUDE_MEMORY_SKIP_TOOLS&&(e.skipTools=process.env.CLAUDE_MEMORY_SKIP_TOOLS.split(",").map(t=>t.trim())),process.env.CLAUDE_MEMORY_DEBUG==="true"&&(e.debug=!0),e}function y(e){O(),n.writeFileSync(o,JSON.stringify(e,null,2))}function _(e,t){return t.skipTools.includes(e)?!1:t.captureTools&&t.captureTools.length>0?t.captureTools.includes(e):!0}function h(e,t,s){if(e.debug){let r=new Date().toISOString();console.error(s?`[${r}] ${t}: ${JSON.stringify(s)}`:`[${r}] ${t}`)}}l.exports={SETTINGS_DIR:i,SETTINGS_FILE:o,DEFAULT_SETTINGS:p,loadSettings:E,saveSettings:y,shouldCaptureTool:_,debugLog:h}});var f=c((U,d)=>{async function I(){return new Promise((e,t)=>{let s="";process.stdin.setEncoding("utf8"),process.stdin.on("data",r=>{s+=r}),process.stdin.on("end",()=>{try{e(s.trim()?JSON.parse(s):{})}catch(r){t(new Error(`Failed to parse stdin JSON: ${r.message}`))}}),process.stdin.on("error",t),process.stdin.isTTY&&e({})})}function u(e){console.log(JSON.stringify(e))}function $(e=null){u(e?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:e}}:{continue:!0,suppressOutput:!0})}function L(e){console.error(`Memory: ${e}`),u({continue:!0,suppressOutput:!0})}d.exports={readStdin:I,writeOutput:u,outputSuccess:$,outputError:L}});var{loadSettings:N,debugLog:g}=S(),{readStdin:b,outputSuccess:m}=f();async function k(){let e=N();try{let s=(await b()).session_id;g(e,"UserPromptSubmit",{sessionId:s}),m()}catch(t){g(e,"Error",{error:t.message}),m()}}k().catch(e=>{console.error(`Supermemory fatal: ${e.message}`),process.exit(1)});
